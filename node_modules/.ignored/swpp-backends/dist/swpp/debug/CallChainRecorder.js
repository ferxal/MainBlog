"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CallChainRecorder = void 0;
const untils_1 = require("../untils");
class CallChainRecorder {
    constructor() {
        this.chain = [];
    }
    push(namespace, key) {
        const size = this.chain.push({ namespace, key });
        const index1 = this.chain.findIndex(it => it.namespace === namespace && it.key === key);
        if (index1 + 1 !== size) {
            throw new untils_1.RuntimeException(untils_1.exceptionNames.circularDependencies, '环境变量产生了循环依赖', {
                chain: this.chain.map((it, index) => {
                    return `${it.namespace}::${it.key}${index % 5 == 4 ? '\n' : ''}`;
                }).join(' -> ')
            });
        }
    }
    pop(namespace, key) {
        const popValue = this.chain.pop();
        if (!popValue || popValue.namespace !== namespace || popValue.key !== key) {
            throw new untils_1.RuntimeException(untils_1.exceptionNames.error, '调用链追踪错误', {
                chain: this.chain, popValue, expected: { namespace, key }
            });
        }
    }
}
exports.CallChainRecorder = CallChainRecorder;
